= Short Introduction to Python Programming 2

== Recap of previous session

=== Arithmetic
[source,python]
----
123/456
----

=== Variables
[source,python]
----
z = 2
z + z
----

=== Data types - Lists, Strings and Dictionaries
[source,python]
----
l = [1, 2, "a"]
l[1]
s = "This is a string"
s[1]
d = { "apple":10, "pear":2}
d["apple"]
----

=== Functions
[source,python]
----
def f(x):
    y = x + 1
    return y+y

f(2)
----


== Loops (again)


[source,python]
----
for i in range(10):
    print(i)
    

# You can also loop over lists

for j in [1, 5, 10]:
    print(j)

# And also do multiple statements in each loop

count = 0
for name in ["Ada", "Bob", "Kris"]:
    count = count + 1
    print("Hello ", name)
print("There are ", count, " people present")

----

=== Challenge

[source,python]
----
# Summing a list

Write a loop that calculates the sum of elements in a list by adding each element and printing the final value, so [124, 402, 36] prints 562

----

.Answer
[%collapsible]
====
[source,python]
----
numbers = [124, 402, 36]
summed = 0
for num in numbers:
    summed = summed + num
print(summed)
----

====


== Comparisons

[source,python]
----
# You can compare values in a number of different ways

# Equals
1 == 1
# Not equals
1 != 2
# Less than
1 < 2
# Less than or equal to
1 <= 1
# Greater than
1 > 1
# Greater than or equal to
1 >= 1

# The data type of the result of this comparison is called Boolean (or Bool)
type(1>1)

# You can also compare the values of more complicated expressions
z = 2
1+1 <= z+2 

----

== Conditional statements

[source,python]
----
# if statments can be used to perform different actions, depending on a condition
x = 11
if x>10:
    print(x, " is larger than 10.")
else:
    print(x, " is less than 10.")

# the else clause is optional

if x>10:
    print(x, " is larger than 10.")


# You can put the if statements inside a loop
# Remember to have the correct number of indentations
for x in range(20):
    if(x>10):
        print(x, " is larger than 10.")
    else:
        print(x, " is smaller than or equal to 10.")

# You can have an elif statement, 
# then the conditions will be checked in order
for x in range(20):
    if x>15:
        print("Great!")
    elif 10 < x <=15: # equivalent to 10 < x and x <=15
        print("Good")
    else:
        print("Not so good")

----

[source,python]
----
# You can also check if a value is in a list/in the keys of a dictionary
a = "apple"
b = ["apple", "pear", "orange"]
c = {"apple": 1, "banana": "orange", "pear": 0}
a in b
a in c
"pear" in c

if a in b :
    print("a is in b")
else:
    print("a is not in b")

# You can also check if some letters are in a string
"a" in "apple"
".txt" in "sample_list.txt"

# You can use "and" and "or" to combine conditions
# You don't have to have the brackets

("a" in "apple") and ("b" in "banana")
("a" in "apple") and ("b" in "pear")
("a" in "apple") or ("b" in "pear")
("a" in "apple") or (1 > 10)

# You can also use not to swap True and False
not True
not (1==2)


----


=== Challenge
[source,python]
----
# Challenge 1
# Given the dictionary above, why is the below False?
"orange" in c 
# Challenge 2
# Fix the code below (4 errors)
x = "10"
if x = 10:
print("x is 10")
    else:
    print("x is not 10")

----

.Answer
[%collapsible]
====
[source,python]
----
# Challenge 1. "orange" is not a key - it's a value under the key "banana"
# Challenge 2.
x = 10
if x == 10:
    print("x is 10")
else:
    print("x is not 10")

----
====

== Using libraries



== Pandas: loading and processing data
[source,python]
----
# Pandas and numpy are two libraries that are commonly used for data processing in python
# Numpy uses slightly different data structure from the traditional python lists,
# which makes it substantially faster when used well.
# Therefore, a lot of the data-centric libraries use numpy.
# Pandas uses numpy and is useful for data cleaning and processing. 
# Pandas is also commonly used in data wrangling and by bioinformatics tools.

# Change your working directory to the folder containing the downloaded example_data

# You can import a library and give it a short name
import numpy as np
import pandas as pd

# Read in a csv file
metadata = pd.read_csv("example_data/metadata/subject.csv")

# Take a look at the imported data
metadata # In a notebook this displays the table. In a script, use print(metadata).

# You can also get some information about the table
metadata.info()

# Look at the object type
type(metadata)

# You can find out the data types for each column
metadata.dtypes

# You can find out the shape (rows, columns) of the data frame 
metadata.shape

# You can get a list of column names
metadata.columns

# You can get a list of indexes (row labels)
metadata.index # In a jupyter notebook, the index is printed in bold down the left hand side



# The pandas.core.frame.DataFrame object type has associated functions (methods)
# Much like how you can do "abc".upper() that turns the string into "ABC"


# You can show the first 5 rows
metadata.head(5)
# or the last one
metadata.tail()

# You can refer to a specific column by using . or [column_name]
metadata.subject_id
metadata["subject_id"] # This is preferred as the dot form can be confused with the dot notation for methods


# And also extract multiple columns
metadata[["subject_id", "age"]]

# You can extract the data for a single index through
metadata.loc[2]



----

== Pandas: Working with data
[source,python]
----
# You can get an overview of a single column
metadata['age'].describe()
# And calculate various properties of it
metadata['age'].min()
metadata['age'].max()
metadata['age'].mean()
metadata['age'].std()
metadata['age'].unique()

# Note that some of these ignore missing values
metadata['age'].count()
len(metadata['age'])
metadata['age'].isna().sum()

# Can remove values from a column that are missing

age_not_missing = metadata["age"].dropna()
age_not_missing.describe()

# Drop rows that have any missing values in any column:

metadata_drop_any_na = metadata.dropna()

# Or you can replace missing values by a default value

mean_age = metadata["age"].mean()
metadata["age_filled"] = metadata["age"].fillna(mean_age)

# You can group data by columns
grouped_data = metadata.groupby('gender')
grouped_data.describe()

# You can write the above in one single line
metadata.groupby('gender').describe()

# You can also compute a single summary, e.g. mean age by gender:

metadata.groupby("gender")["age"].mean()

# Usually loc selects rows by label
metadata.loc[2]
# But we can also use it to filter data
metadata.loc[metadata["age"] > 40]

# You can also extract a range of rows, and combine this with selecting particular columns
metadata.loc[10:20, ["age", "gender"]] 

# There's also iloc, which can be used to access data by its position
metadata.iloc[0,0]

# You can also add a new column
metadata["age_in_decades"] = metadata["age"] / 10
metadata

# Assigning to an existing column will overwrite it

# First make a copy of the dataframe
metadata_copy = metadata.copy()

# Cleaning up the gender column
metadata_copy["gender"].str.upper()
# In order to fix this in the dataframe we need to assign it to the column
metadata_copy["gender"] = metadata_copy["gender"].str.upper()
# Now the column only contains M and F
metadata_copy["gender"].unique()
----

=== Challenge

[source,python]
----
# Challenge 1: From the metadata DataFrame, select only the subjects 35 years old or younger and display just their subject_id and age.

# Challenge 2: Find the mean ages of the subjects undergoing the two treatments

----

.Answer
[%collapsible]
====

[source,python]
----
## Challenge 1: 
younger_than_35 = metadata.loc[metadata["age"] <= 35, ["subject_id", "age"]]
younger_than_35

## Challenge 2:
mean_age_by_treatment = metadata.groupby("treatment")["age"].mean()
mean_age_by_treatment
----
====


### Plotting data (matplotlib)

[source,python]
----
# There are multiple different plotting libraries for Python.
# matplotlib is a popular one

import matplotlib.pyplot as plt


# We can plot line graphs

plt.figure()
plt.plot([1, 2, 3], [8, 4, 2])
plt.plot([1, 2, 3], [3, 2, 1], c="g") # Plot this line in green
plt.show()

# Note that plt.figure() and plt.show() aren't needed in notebooks, but are in other scripts.

# Scatter plots
plt.scatter([1, 2, 3], [8, 4, 2])
# In a notebook, you can just call plt.scatter / plt.bar and it will show automatically.

# Bar charts
plt.bar(["Dogs", "Cats"], [20, 10])

# There are also pandas plotting functions which build on matplotlib
# Histograms
metadata["age"].hist()
plt.xlabel("Age")
plt.ylabel("Frequency")
plt.title("Distribution of subject ages")

# And bar plots
metadata["gender"].value_counts().plot(kind="bar")
plt.xlabel("Gender")
plt.ylabel("Number of subjects")
plt.title("Number of subjects by gender")

----

=== Challenge

[source,python]
----
## Challenge: 
Using the metadata DataFrame, make a bar plot of the mean age for each gender.

### Hint:
1. Group by 'gender' and calculate the mean of the 'age' column.
2. Use the pandas .plot() method on the result (kind='bar').
----

.Answer
[%collapsible]
====

[source,python]
----
## Group by genderand calculate mean age

mean_age_by_gender= metadata.groupby("gender")["age"].mean()

## Make a bar plot of the mean ages
mean_age_by_gender.plot(kind="bar")
plt.xlabel("Gender")
plt.ylabel("Mean age")
plt.title("Mean age by gender")
plt.show()
----
====


=== Files and directories

[source,python]
----
# You can import libraries with functions that allow you to do specific tasks.
# Related phrases you may have heard include packages and modules.
# There are subtle differences between these terms in python, but don't worry about them for now.

# Python has several standard libraries that are already installed
# Import the os library - this library allows python to interact with your operating system
import os

# This allows you to list all the files/folders in a specified folder (dir/directory) 
# (or your current working directory if not specified)
os.listdir()

# You an specify a folder
os.listdir("20251203_DSI_python2")

# You can use slashes to indicate subfolders
# Notice that Python uses forward slashes (/) when indicating folders,
# whereas Windows use backward slashes (\)
# If you copied your folder path from Windows, remember to change the slashes
os.listdir("20251203_DSI_python2/example_data")

# You can also change your working directory
# Once you have changed your working directory, 
# this folder becomes your point of reference
os.chdir("20251203_DSI_python2/example_data")
os.listdir()

# You can check if something is a file or a folder (dir/directory)
os.path.isdir("collected_data")

----

=== Challenge
[source,python]
----
## Challenge 1: Change your working directory to a different folder

## Challenge 2: List files/folders in a folder

## Challenge 3: Download the example_data folder as a zip file and extract it.
# Print out the names of all files/folders at the second level within  example_data/collected_data
# The data for each day is within a separate subfolder
# e.g. collected_data/day1/data1.csv, collected_data/day1/data2.csv etc.

----

.Answer
[%collapsible]
====

[source,python]
----
## Challenge 3:

# Assumes we are in biocodingClub/python/20251203_DSI_python2/example_data
# Folder for looping through 

main_folder = "collected_data"
# list the directories in your folder
filefolder_list = os.listdir(main_folder)# Loop through the files within each folder (dir/directory)
for filefolder in filefolder_list:
    # Add the path from your folder to form the full path for each of the file/subfolder
    filefolder_path = main_folder + "/" + filefolder # or os.path.join(main_folder, filefolder)
    

    # Check if this is a file or a folder
    # Only perform the following if it is a folder
    if os.path.isdir(filefolder_path):
        # Find out what files are in the subfolder referred to in the current loop
        files_in_subfolder = os.listdir(filefolder_path)
        # Go through each of these files and print them out
        for current_file in files_in_subfolder:
            # Add the file path from your folder to form the full file path for each of the subfolder
            print(filefolder_path+"/" +current_file)
----
====